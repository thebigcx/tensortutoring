var S=(p,m,n)=>new Promise((l,c)=>{var s=r=>{try{h(n.next(r))}catch(a){c(a)}},g=r=>{try{h(n.throw(r))}catch(a){c(a)}},h=r=>r.done?l(r.value):Promise.resolve(r.value).then(s,g);h((n=n.apply(p,m)).next())});(function(){let p=null,m=!1,n=-1;const l=document.getElementById("docmd-search-modal"),c=document.getElementById("docmd-search-input"),s=document.getElementById("docmd-search-results"),g=window.DOCMD_ROOT||"./";if(!l)return;const h='<div class="search-initial">Type to start searching...</div>';function r(){l.style.display="flex",c.focus(),c.value.trim()||(s.innerHTML=h,n=-1),m||L()}function a(){l.style.display="none",n=-1}document.addEventListener("keydown",e=>{if((e.metaKey||e.ctrlKey)&&e.key==="k"&&(e.preventDefault(),l.style.display==="flex"?a():r()),l.style.display==="flex"){const t=s.querySelectorAll(".search-result-item");if(e.key==="Escape")e.preventDefault(),a();else if(e.key==="ArrowDown"){if(e.preventDefault(),t.length===0)return;n=(n+1)%t.length,w(t)}else if(e.key==="ArrowUp"){if(e.preventDefault(),t.length===0)return;n=(n-1+t.length)%t.length,w(t)}else e.key==="Enter"&&(e.preventDefault(),n>=0&&t[n]?t[n].click():t.length>0&&t[0].click())}});function w(e){e.forEach((t,i)=>{i===n?(t.classList.add("selected"),t.scrollIntoView({block:"nearest"})):t.classList.remove("selected")})}document.querySelectorAll(".docmd-search-trigger").forEach(e=>{e.addEventListener("click",r)}),l.addEventListener("click",e=>{e.target===l&&a()});function L(){return S(this,null,function*(){try{const e=`${g}search-index.json`,t=yield fetch(e);if(!t.ok)throw new Error(t.status);const i=yield t.text();p=MiniSearch.loadJSON(i,{fields:["title","headings","text"],storeFields:["title","id","text"],searchOptions:{fuzzy:.2,prefix:!0,boost:{title:2,headings:1.5}}}),m=!0,c.value.trim()&&c.dispatchEvent(new Event("input"))}catch(e){console.error("Failed to load search index",e),s.innerHTML='<div class="search-error">Failed to load search index.</div>'}})}function T(e,t){if(!e)return"";const i=t.split(/\s+/).filter(u=>u.length>2),d=e.toLowerCase();let o=-1;for(const u of i){const E=d.indexOf(u.toLowerCase());if(E>=0){o=E;break}}const y=60;let v=0,x=120;o>=0&&(v=Math.max(0,o-y),x=Math.min(e.length,o+y));let f=e.substring(v,x);v>0&&(f="..."+f),x<e.length&&(f=f+"...");const k=i.map(u=>u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")).join("|");if(k){const u=new RegExp(`(${k})`,"gi");f=f.replace(u,"<mark>$1</mark>")}return f}c.addEventListener("input",e=>{const t=e.target.value.trim();if(n=-1,!t){s.innerHTML=h;return}if(!m)return;const i=p.search(t);$(i,t)});function $(e,t){if(e.length===0){s.innerHTML='<div class="search-no-results">No results found.</div>';return}const i=e.slice(0,10).map((d,o)=>{const y=T(d.text,t);return`
                <a href="${`${g}${d.id}`}" class="search-result-item" data-index="${o}" onclick="window.closeDocmdSearch()">
                    <div class="search-result-title">${d.title}</div>
                    <div class="search-result-preview">${y}</div>
                </a>
            `}).join("");s.innerHTML=i,s.querySelectorAll(".search-result-item").forEach((d,o)=>{d.addEventListener("mouseenter",()=>{n=o,w(s.querySelectorAll(".search-result-item"))})})}window.closeDocmdSearch=a})();
